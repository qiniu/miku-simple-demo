<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Miku</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="container">
    <main class="main">
      <h1 class="title">
        Miku
      </h1>

      <pre class="sample-code"><code>&lt;script src="/miku-delivery-1.3.0.js"&gt;&lt;/script&gt;

&lt;script&gt;
  mikuDelivery.initProxy('/miku-delivery-sw-1.3.0.js', {
    app: { appID: '&lt;APP_ID&gt;', appSalt: '&lt;APP_SALT&gt;' },
    domains: ['www-static.qnssl.com']
  })
&lt;/script&gt;</code></pre>

      <ul class="grid">
        <li class="card">
          <h2>Image</h2>
          <img alt="Fabric" src="https://www-static.qnssl.com/_netr_test/fabric.jpeg" />
          <div class="bottom">
            <p class="url">
              <a target="_blank" rel="noreferrer" href="https://www-static.qnssl.com/_netr_test/fabric.jpeg">
                <code>fabric.jpeg</code>
              </a>
            </p>
            <div class="download-icon" title="Download">
              <a download href="https://www-static.qnssl.com/_netr_test/fabric.jpeg">
                <img src="/download.svg" />
              </a>
            </div>
          </div>
        </li>
        <li class="card">
          <h2>Video</h2>
          <video controls playsinline data-src="https://www-static.qnssl.com/_netr_test/forest-compress.mp4"></video>
          <div class="bottom">
            <p class="url">
              <a target="_blank" rel="noreferrer" href="https://www-static.qnssl.com/_netr_test/forest-compress.mp4">
                <code>forest-compress.mp4</code>
              </a>
            </p>
            <div class="download-icon" title="Download">
              <a download href="https://www-static.qnssl.com/_netr_test/forest-compress.mp4">
                <img src="/download.svg" />
              </a>
            </div>
          </div>
        </li>
        <li class="card">
          <h2>Audio</h2>
          <audio controls data-src="https://www-static.qnssl.com/_netr_test/ukulele.mp3"></audio>
          <div class="bottom">
            <p class="url">
              <a target="_blank" rel="noreferrer" href="https://www-static.qnssl.com/_netr_test/ukulele.mp3">
                <code>ukulele.mp3</code>
              </a>
            </p>
            <div class="download-icon" title="Download">
              <a download href="https://www-static.qnssl.com/_netr_test/ukulele.mp3">
                <img src="/download.svg" />
              </a>
            </div>
          </div>
        </li>
        <li class="card">
          <h2>Long Video</h2>
          <video controls playsinline data-src="https://www-static.qnssl.com/_netr_test/the-internets-own-boy.ogv"></video>
          <div class="bottom">
            <p class="url">
              <a target="_blank" rel="noreferrer" href="https://www-static.qnssl.com/_netr_test/the-internets-own-boy.ogv">
                <code>the-internets-own-boy.ogv</code>
              </a>
            </p>
            <div class="download-icon" title="Download">
              <a download href="https://www-static.qnssl.com/_netr_test/the-internets-own-boy.ogv">
                <img src="/download.svg" />
              </a>
            </div>
          </div>
        </li>
      </ul>
    </main>
  </div>

  <script src="/miku-delivery-1.3.0.js"></script>

  <script>
    const app = { appID: 'ao89rvrjpyi4gn57', appSalt: 'reimp7tnc2y9p11hckwz10lt3tigw8e7' }
    const domains = ['www-static.qnssl.com']
    const mediaEls = [...document.getElementsByTagName('video'), ...document.getElementsByTagName('audio')]

    if ('serviceWorker' in navigator) {
      mikuDelivery.initProxy('/miku-delivery-sw-1.3.0.js', {
        app,
        domains,
        anchorDownload: true
      }).finally(() => {
        // 推迟 `<video>`、`<audio>` 加载，避免 chrome 的这个问题 https://bugs.chromium.org/p/chromium/issues/detail?id=1406478
        setTimeout(() => {
          mediaEls.forEach(media => { media.setAttribute('src', media.getAttribute('data-src')) })
        }, 100)
      })
    } else {
      mikuDelivery.initMediaLoader({ app, domains })
      mediaEls.forEach(media => { mikuDelivery.loadMedia(media, media.getAttribute('data-src')) })
    }
  </script>

</body>
</html>
